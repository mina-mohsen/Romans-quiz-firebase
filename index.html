<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مسابقة رسالة كورنثوس الأولى - الأصحاح الأول</title>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, getDocs, serverTimestamp, query } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        let db, auth, user;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'corinthians-quiz-1';
        
        async function initFirebase() {
            try {
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (e) { 
                        console.error("Auth failed, retrying...");
                        setTimeout(initAuth, 2000);
                    }
                };
                
                initAuth();
                onAuthStateChanged(auth, (u) => { 
                    user = u;
                    console.log("Auth State Changed:", u ? "Logged In" : "Logged Out");
                });
            } catch (e) { console.error("Firebase Init Error"); }
        }

        initFirebase();

        const questions = [
            { q: "من هو الشخص الذي شارك بولس الرسول في إرسال التحية لكورنثوس؟", options: ["تيموثاوس", "سوسثانيس", "لوقا", "سيلا"], correct: 1, ref: "1:1" },
            { q: "بماذا دُعي بولس في بداية الرسالة؟", options: ["رسولاً مختاراً", "رسولاً مدعواً", "خادماً لله", "تلميذاً للمسيح"], correct: 1, ref: "1:1" },
            { q: "بأي صفة وُصف المؤمنون في كورنثوس؟", options: ["المقدسين في المسيح يسوع", "الأبرار بالنعمة", "حفظة الناموس", "رعية الله"], correct: 0, ref: "1:2" },
            { q: "ما هي البركة التي يطلبها بولس في التحية؟", options: ["إيمان ورجاء", "نعمة وسلام", "قوة وثبات", "محبة وفرح"], correct: 1, ref: "1:3" },
            { q: "لماذا يشكر بولس إلهه دائماً من جهتهم؟", options: ["لأجل صبرهم", "لأجل نعمة الله المعطاة لهم", "لأجل كثرة عددهم", "لأجل صومهم"], correct: 1, ref: "1:4" },
            { q: "في أي شيء استغنى أهل كورنثوس في المسيح؟", options: ["في كل كلمة وكل علم", "في الأموال المادية", "في القوة العسكرية", "في الفلسفة اليونانية"], correct: 0, ref: "1:5" },
            { q: "ماذا تأيد بينهم حسب قول بولس الرسول؟", options: ["ناموس موسى", "شهادة المسيح", "تعاليم الفلاسفة", "أقوال الأنبياء"], correct: 1, ref: "1:6" },
            { q: "بولس يقول أنهم غير ناقصين في أي...؟", options: ["موهبة", "كلمة", "عمل", "فكر"], correct: 0, ref: "1:7" },
            { q: "ماذا ينتظر المؤمنون في كورنثوس؟", options: ["نهاية العالم", "استعلان ربنا يسوع المسيح", "زيارة بولس", "الموت"], correct: 1, ref: "1:7" },
            { q: "من هو الذي سيثبتهم إلى النهاية بلا لوم؟", options: ["بولس الرسول", "يسوع المسيح", "سوسثانيس", "الأسقف"], correct: 1, ref: "1:8" },
            { q: "الله أمين الذي به دُعيتم إلى... ابنه؟", options: ["خدمة", "شركة", "تمجيد", "رؤية"], correct: 1, ref: "1:9" },
            { q: "بأي اسم يناشدهم بولس أن يتكلموا جميعاً قولا واحداً؟", options: ["اسم الله الآب", "اسم ربنا يسوع المسيح", "اسم الروح القدس", "اسمه هو الشخصي"], correct: 1, ref: "1:10" },
            { q: "ماذا طلب بولس ألا يكون بينهم؟", options: ["خطايا", "انشقاقات", "نقاشات", "صلوات"], correct: 1, ref: "1:10" },
            { q: "من هم الذين أخبروا بولس عن وجود خصومات في كورنثوس؟", options: ["أهل أفسس", "أهل خلوي", "أهل روما", "أهل غلاطية"], correct: 1, ref: "1:11" },
            { q: "ماذا كان يقول البعض في كورنثوس عن تبعيتهم؟", options: ["أنا لبولس", "أنا لأبلوس", "أنا لصفا", "كل ما سبق"], correct: 3, ref: "1:12" },
            { q: "من المقصود بـ 'صفا' في الرسالة؟", options: ["بولس", "بطرس", "لوقا", "برنابا"], correct: 1, ref: "1:12" },
            { q: "ما هو السؤال الاستنكاري الذي سأله بولس؟", options: ["هل المسيح غائب؟", "هل انقسم المسيح؟", "هل تألم المسيح؟", "هل قام المسيح؟"], correct: 1, ref: "1:13" },
            { q: "هل صُلب بولس لأجل أهل كورنثوس؟", options: ["نعم", "كلا", "ربما", "لم يذكر"], correct: 1, ref: "1:13" },
            { q: "باسم من اعتمد أهل كورنثوس؟", options: ["اسم بولس", "اسم أبلوس", "اسم الرب يسوع", "اسم سوسثانيس"], correct: 2, ref: "1:13" },
            { q: "من هم الأشخاص الذين ذكر بولس أنه عمدهم بنفسه؟", options: ["كريسبس وغايس", "سوسثانيس ولوقا", "بطرس وأندراوس", "مريم ومرثا"], correct: 0, ref: "1:14" },
            { q: "أي بيت قام بولس بتعميده أيضاً؟", options: ["بيت ليديا", "بيت استفاناس", "بيت كيرنيليوس", "بيت فيلبس"], correct: 1, ref: "1:16" },
            { q: "لماذا أرسل المسيح بولس حسب قوله؟", options: ["ليعمد فقط", "ليبشر", "ليحاكم", "ليجمع أموالاً"], correct: 1, ref: "1:17" },
            { q: "بشر بولس الإنجيل بغير... لئلا يتعطل صليب المسيح؟", options: ["حكمة كلام", "مال كثير", "خوف", "تردد"], correct: 0, ref: "1:17" },
            { q: "كلمة الصليب عند الهالكين هي...؟", options: ["قوة", "جهالة", "فلسفة", "حزن"], correct: 1, ref: "1:18" },
            { q: "كلمة الصليب عندنا نحن المخلصين هي...؟", options: ["حكمة بشرية", "قوة الله", "ضعف إنساني", "خرافة"], correct: 1, ref: "1:18" },
            { q: "ماذا سيفعل الله بحكمة الحكماء حسب المكتوب؟", options: ["يبيدها", "يمجدها", "يجمعها", "ينشرها"], correct: 0, ref: "1:19" },
            { q: "أين الحكيم؟ أين الكاتب؟ أين... هذا الدهر؟", options: ["مباحث", "فيلسوف", "ملك", "غني"], correct: 0, ref: "1:20" },
            { q: "ألم يجهل الله... هذا العالم؟", options: ["قوة", "حكمة", "جمال", "فنون"], correct: 1, ref: "1:20" },
            { q: "بواسطة ماذا سُرّ الله أن يخلص المؤمنين؟", options: ["جهالة الكرازة", "حكمة المنطق", "المعجزات الكبرى", "المال والجاه"], correct: 0, ref: "1:21" },
            { q: "ماذا يطلب اليهود؟", options: ["حكمة", "آية", "مالاً", "سلطة"], correct: 1, ref: "1:22" },
            { q: "ماذا يطلب اليونانيون؟", options: ["آيات", "حكمة", "أساطير", "أوثان"], correct: 1, ref: "1:22" },
            { q: "نحن نكرز بـ...؟", options: ["المسيح مصلوباً", "المسيح ملكاً أرضياً", "المسيح فيلسوفاً", "المسيح غنياً"], correct: 0, ref: "1:23" },
            { q: "المسيح المصلوب لليهود هو...؟", options: ["قوة", "عثرة", "حكمة", "فرح"], correct: 1, ref: "1:23" },
            { q: "المسيح المصلوب لليونانيين هو...؟", options: ["جهالة", "منطق", "حقيقة", "سر"], correct: 0, ref: "1:23" },
            { q: "المسيح هو قوة الله و... الله للمدعوين؟", options: ["مجد", "حكمة", "رحمة", "خوف"], correct: 1, ref: "1:24" },
            { q: "جهالة الله أحكم من...؟", options: ["الناس", "الملائكة", "الشياطين", "الفلاسفة"], correct: 0, ref: "1:25" },
            { q: "ضعف الله أقوى من...؟", options: ["الناس", "الحديد", "الموت", "المرض"], correct: 0, ref: "1:25" },
            { q: "انظروا دعوتكم، ليس كثيرون... حسب الجسد؟", options: ["أقوياء", "حكماء", "أغنياء", "ملوك"], correct: 1, ref: "1:26" },
            { q: "ليس كثيرون... ليس كثيرون شرفاء؟", options: ["علماء", "مقتدرين", "فقراء", "مساكين"], correct: 1, ref: "1:26" },
            { q: "اختار الله جهال العالم ليخزي...؟", options: ["الأشرار", "الحكماء", "الضعفاء", "الأغنياء"], correct: 1, ref: "1:27" },
            { q: "اختار الله ضعفاء العالم ليخزي...؟", options: ["الأقوياء", "المرضى", "الفلاسفة", "المتكبرين"], correct: 0, ref: "1:27" },
            { q: "اختار الله أدنياء العالم و...؟", options: ["المزدرى وغير الموجود", "المعروف والمشهور", "الأغنياء والملوك", "الحكماء والعلماء"], correct: 0, ref: "1:28" },
            { q: "لماذا اختار الله هذه الأمور الضعيفة؟", options: ["لكي يبطل الموجود", "لكي يجمع المال", "لكي يحارب الرومان", "لكي يمدح الفقر"], correct: 0, ref: "1:28" },
            { q: "لكي لا يفتخر كل ذي جسد...؟", options: ["أمام الناس", "أمام الله", "أمام نفسه", "أمام الشياطين"], correct: 1, ref: "1:29" },
            { q: "منه أنتم بالمسيح يسوع الذي صار لنا... من الله؟", options: ["حكمة وبراً", "قوة وغنى", "صحة وعافية", "علماً ومنطقاً"], correct: 0, ref: "1:30" },
            { q: "ماذا صار لنا المسيح أيضاً؟", options: ["قداسة وفداء", "مالاً وجاهاً", "خوفاً ورهبة", "حزناً وألماً"], correct: 0, ref: "1:30" },
            { q: "من افتخر فليفتخر بـ...؟", options: ["بعلمه", "بالرب", "بأعماله", "بنسبه"], correct: 1, ref: "1:31" },
            { q: "كم عدد آيات الأصحاح الأول؟", options: ["20 آية", "31 آية", "25 آية", "40 آية"], correct: 1, ref: "الأصحاح 1" },
            { q: "من هو كاتب هذه الرسالة؟", options: ["بطرس الرسول", "بولس الرسول", "يوحنا الرسول", "يعقوب الرسول"], correct: 1, ref: "1:1" },
            { q: "لمن وُجهت الرسالة؟", options: ["كنيسة روما", "كنيسة كورنثوس", "كنيسة أفسس", "كنيسة غلاطية"], correct: 1, ref: "1:2" },
            { q: "ما هي العبارة المتكررة في الأصحاح؟", options: ["حكمة الناس", "قوة الله", "بالمسيح يسوع", "بفعل الناموس"], correct: 2, ref: "1:1-31" },
            { q: "بأي شيء أراد بولس معالجة الانقسامات؟", options: ["بالقوة", "باسم ربنا يسوع المسيح", "بالمال", "بالتهديد"], correct: 1, ref: "1:10" },
            { q: "هل اعتمد بولس عدداً كبيراً في كورنثوس؟", options: ["نعم الجميع", "لا أحد", "عدد قليل ذكره بالاسم", "لم يذكر"], correct: 2, ref: "1:14-16" },
            { q: "ما هو المركز الأساسي للأصحاح؟", options: ["الختان", "صليب المسيح وحكمته", "جمع الصدقات", "رحلات بولس"], correct: 1, ref: "1:18" },
            { q: "أين كُتب 'سأبيد حكمة الحكماء'؟", options: ["في الإنجيل", "في العهد القديم", "في الرسالة لروما", "في رؤيا يوحنا"], correct: 1, ref: "1:19" },
            { q: "لماذا لم تدرك الحكمة البشرية الله؟", options: ["لأن الله أخفى نفسه", "لأن العالم لم يعرف الله بحكمته", "لأن الفلسفة صعبة", "لأن الكتب ضاعت"], correct: 1, ref: "1:21" },
            { q: "ماذا يمثل صليب المسيح للمؤمنين؟", options: ["فشلاً", "قوة الله وحكمته", "مجرد ذكرى", "حكماً بالموت"], correct: 1, ref: "1:24" },
            { q: "ماذا قصد بولس بـ 'المزدري وغير الموجود'؟", options: ["الأوثان", "الأمم", "الأباطرة", "الفلاسفة"], correct: 1, ref: "1:28" },
            { q: "كيف نال المؤمنون البر والقداسة؟", options: ["بأعمالهم", "بالمسيح يسوع", "بحفظ السبت", "بدراسة الفلسفة"], correct: 1, ref: "1:30" },
            { q: "ما الهدف النهائي من اختيار الله للضعفاء؟", options: ["إهانة الناس", "أن لا يفتخر بشر أمامه", "تغيير الحكم", "نشر الفقر"], correct: 1, ref: "1:29" }
        ];

        let current = 0, answers = new Array(questions.length).fill(null), timeLeft = 20 * 60, timer;
        const lockKey = "corinth_lock_1";

        window.startQuiz = () => {
            const fields = ['u-name', 'u-phone', 'u-address', 'u-birthdate'];
            for(let f of fields) if(!document.getElementById(f).value.trim()) return alert("برجاء ملء كافة البيانات.");
            if(localStorage.getItem(lockKey)) return alert("لقد شاركت مسبقاً.");
            
            switchScreen('quiz-screen');
            document.getElementById('timer-box').style.display = 'inline-block';
            initQuiz();
            startTimer();
        };

        function initQuiz() {
            const wrapper = document.getElementById('q-wrapper');
            const grid = document.getElementById('nav-grid');
            wrapper.innerHTML = ""; grid.innerHTML = "";
            questions.forEach((q, i) => {
                const div = document.createElement('div');
                div.className = `screen ${i===0?'active-screen':''}`;
                div.id = `q-cnt-${i}`;
                div.innerHTML = `<div class="q-text">${i+1}. ${q.q}</div>${q.options.map((opt, idx) => `<div class="option-item" id="opt-${i}-${idx}" onclick="selectOption(${i}, ${idx})">${opt}</div>`).join('')}`;
                wrapper.appendChild(div);
                const dot = document.createElement('div');
                dot.className = `nav-dot ${i===0?'current':''}`;
                dot.id = `dot-${i}`; dot.innerText = i+1; dot.onclick = () => jump(i);
                grid.appendChild(dot);
            });
        }

        window.selectOption = (qIdx, optIdx) => {
            answers[qIdx] = optIdx;
            document.querySelectorAll(`#q-cnt-${qIdx} .option-item`).forEach((el, idx) => el.classList.toggle('selected', idx === optIdx));
            document.getElementById(`dot-${qIdx}`).classList.add('answered');
            setTimeout(() => nav(1), 250);
        };

        window.jump = (n) => {
            document.querySelectorAll('#q-wrapper .screen').forEach(c => c.classList.remove('active-screen'));
            document.querySelectorAll('.nav-dot').forEach(d => d.classList.remove('current'));
            current = n;
            document.getElementById(`q-cnt-${current}`).classList.add('active-screen');
            document.getElementById(`dot-${current}`).classList.add('current');
            document.getElementById('finish-btn').style.display = (current === questions.length - 1) ? 'block' : 'none';
        };

        window.nav = (step) => { let t = current + step; if(t >= 0 && t < questions.length) jump(t); };

        function startTimer() {
            timer = setInterval(() => {
                timeLeft--;
                if(timeLeft <= 0) finishQuiz(true);
                const m = Math.floor(timeLeft/60), s = timeLeft%60;
                document.getElementById('timer-box').innerText = `${m}:${s<10?'0':''}${s}`;
            }, 1000);
        }

        window.finishQuiz = async (auto = false) => {
            if(!auto && !confirm("إنهاء الاختبار؟")) return;
            clearInterval(timer);
            let score = 0;
            questions.forEach((q, i) => { if(answers[i] === q.correct) score++; });
            
            switchScreen('results-screen');
            document.getElementById('final-score').innerText = `${score}/60`;
            document.getElementById('timer-box').style.display = 'none';
            generateReview();
            localStorage.setItem(lockKey, "done");

            if (user && db) {
                try {
                    const resultsCol = collection(db, "artifacts", appId, "public", "data", "results");
                    await addDoc(resultsCol, {
                        name: document.getElementById('u-name').value,
                        phone: document.getElementById('u-phone').value,
                        address: document.getElementById('u-address').value,
                        birthdate: document.getElementById('u-birthdate').value,
                        score: score,
                        uid: user.uid,
                        timestamp: serverTimestamp()
                    });
                } catch (e) { console.error("Save background failed", e); }
            }
        };

        function generateReview() {
            const list = document.getElementById('review-list');
            list.innerHTML = questions.map((q, i) => `
                <div class="review-card ${answers[i] === q.correct ? 'correct-card' : 'wrong-card'}">
                    <b>${i+1}. ${q.q}</b><br>
                    <span>إجابتك: ${answers[i] !== null ? q.options[answers[i]] : 'لا يوجد'}</span><br>
                    ${answers[i] !== q.correct ? `<span style="color:green">الصح: ${q.options[q.correct]}</span><br>` : ''}
                    <small style="color:darkorange">المرجع: 1 كو ${q.ref}</small>
                </div>
            `).join('');
        }

        window.showReview = () => document.getElementById('review-list').style.display = 'block';

        window.showAdmin = async () => {
            if (!user) return alert("الرجاء الانتظار حتى يتم تحميل النظام...");
            const pass = prompt("كلمة السر:");
            if(pass === "24724") {
                switchScreen('admin-screen');
                const content = document.getElementById('admin-content');
                content.innerText = "جاري التحميل...";
                try {
                    const col = collection(db, "artifacts", appId, "public", "data", "results");
                    const snap = await getDocs(col);
                    let results = [];
                    snap.forEach(d => results.push(d.data()));
                    
                    if (results.length === 0) {
                        content.innerText = "لا توجد نتائج مسجلة بعد.";
                        return;
                    }
                    
                    results.sort((a,b) => b.score - a.score);
                    content.innerHTML = `<table><tr><th>الاسم</th><th>الدرجة</th><th>تاريخ الميلاد</th></tr>
                        ${results.map(r => `<tr><td>${r.name}</td><td>${r.score}</td><td>${r.birthdate || '-'}</td></tr>`).join('')}
                    </table>`;
                } catch(e) { 
                    console.error(e);
                    content.innerText = "حدث خطأ في جلب البيانات. تأكد من جودة الإنترنت."; 
                }
            }
        };

        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById(id).classList.add('active-screen');
        }
    </script>

    <style>
        :root { --p: #2c3e50; --s: #34495e; --acc: #d35400; --win: #27ae60; --err: #c0392b; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #ecf0f1; margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 500px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        header { text-align: center; border-bottom: 2px solid #eee; margin-bottom: 15px; position: relative; }
        #timer-box { color: var(--err); font-weight: bold; font-size: 1.1rem; display: none; }
        .screen { display: none; flex-direction: column; gap: 12px; }
        .active-screen { display: flex; }
        label { font-size: 0.8rem; color: #666; margin-bottom: -10px; margin-right: 5px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 100%; font-size: 0.9rem; }
        .btn-main { background: var(--p); color: white; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .q-text { font-weight: bold; margin-bottom: 8px; font-size: 1rem; }
        .option-item { background: #f9f9f9; padding: 10px; border: 1px solid #eee; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .option-item.selected { background: #d1ecf1; border-color: #0c5460; font-weight: bold; }
        .nav-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; margin-top: 10px; }
        .nav-dot { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; background: #eee; border-radius: 3px; font-size: 0.6rem; cursor: pointer; }
        .nav-dot.current { border: 2px solid var(--p); }
        .nav-dot.answered { background: var(--win); color: white; }
        .review-card { padding: 8px; border-radius: 6px; margin-bottom: 8px; font-size: 0.85rem; border: 1px solid #eee; }
        .correct-card { border-right: 4px solid var(--win); background: #f0fff4; }
        .wrong-card { border-right: 4px solid var(--err); background: #fff5f5; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.75rem; }
        th, td { border: 1px solid #eee; padding: 6px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div id="timer-box">20:00</div>
        <h3 id="app-title" onclick="showAdmin()" style="cursor: pointer;">مسابقة 1 كورنثوس 1</h3>
    </header>

    <!-- Registration -->
    <div id="reg-screen" class="screen active-screen">
        <div style="text-align: center;">
            <img src="https://imgur.com/hH7HWvE.jpeg" style="width: 80px; height: 80px; border-radius: 50%;">
        </div>
        <input type="text" id="u-name" placeholder="الاسم الكامل">
        <input type="tel" id="u-phone" placeholder="رقم الموبايل">
        <input type="text" id="u-address" placeholder="العنوان">
        <label>تاريخ الميلاد:</label>
        <input type="date" id="u-birthdate">
        <button class="btn-main" onclick="startQuiz()">ابدأ الآن</button>
    </div>

    <!-- Quiz -->
    <div id="quiz-screen" class="screen">
        <div id="q-wrapper"></div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button class="btn-main" style="background:#7f8c8d" onclick="nav(-1)">السابق</button>
            <button class="btn-main" onclick="nav(1)">التالي</button>
        </div>
        <button id="finish-btn" class="btn-main" style="background:var(--win); display:none;" onclick="finishQuiz()">إنهاء</button>
        <div class="nav-grid" id="nav-grid"></div>
    </div>

    <!-- Results -->
    <div id="results-screen" class="screen">
        <div style="text-align: center;">
            <h1 id="final-score" style="color:var(--win); font-size: 2.5rem;">0/60</h1>
            <p>تم تسجيل نتيجتك بنجاح.</p>
            <button class="btn-main" onclick="showReview()">مراجعة الإجابات</button>
        </div>
        <div id="review-list" style="display: none; margin-top: 15px;"></div>
    </div>

    <!-- Admin -->
    <div id="admin-screen" class="screen">
        <h4>لوحة التحكم - النتائج</h4>
        <div id="admin-content" style="overflow-x: auto; min-height: 100px;"></div>
        <button class="btn-main" onclick="location.reload()">خروج</button>
    </div>
</div>

</body>
</html>
